<html>
	<head>
		<title>Heilly Galvez - Container Traffic Waves</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="/assets/css/main.css" />
	</head>
	<body class="is-preload">
			<!-- Wrapper -->
				<div id="wrapper">
	
					<!-- Main -->
						<div id="main">
							<div class="inner">
	
								<!-- Header -->
							<header id="header">
								<a href="/index.html" class="logo"><strong>Heilly GÃ¡lvez</strong></a> 

		
								<ul class="icons">
									<li><a href="/contact.html" class="icon fa-envelope"></a></li>
									<li><a href="http://www.linkedin.com/in/heillygalvez" class="icon brands fa-linkedin"></a></li>
									<li><a href="https://github.com/heillygalvez" class="icon brands fa-github"><span class="label">Github</span></a></li>										
								</ul>
							</header>
	
								<!-- Content -->
								
									<!-- Section -->
									<section>
										<header class="major">
											<h2>Container Traffic Waves ðŸš¢</h2>
										</header>
										<p>
											Working in the e-commerce industry, I had been made aware of the shipping 
											container shortage cause by Covid-19 in 2021. Being Panamanian, and knowing 
											that maritime transport is one of the pillars of Panamanian economy, I can't 
											help but wonder how ports back home are <i>faring</i>.
										</p>
										<p>
											Fortunately, I was able to find this 
											<a href="https://www.datosabiertos.gob.pa/dataset/amp-movimiento-de-contenedores-en-el-spn-por-tipo-en-teu-diciembre-2021/resource/ce85bf03-f42b-41dc-b34c-14c1b626370c">
											</a> by the Panamanian Maritime Authority on container traffic, both empty and 
											full,  measured in TEU's (twenty-foot equivalent units) processed every month in 
											2019 through 2021.
										</p>
										<p>
											After looking at the table for a while and seeing there were only six ports to 
											track over three years, a bump chart seemed like the ideal representation. In 
											addition to how each port ranked among all ports for a quarter, I decided 
											to add another visual encoding: How each quarter compared to the rest for any given 
											port by varying the amplitude of each line. After playing with a few curves, I noticed 
											the mimicking ocean waves could be an appropriate metaphor ðŸŒŠ. This required changing the 
											traditional bump chart so that I wasn't referring to points in time, but to ranges 
											instead.
										</p>

										<div style="display:flex; justify-content: center;" id="observablehq-viewof-category-d9ef52ea"></div>
										<div style="display:flex; justify-content: center;" id="observablehq-plot-d9ef52ea"></div>
										<div style="display: none" id="observablehq-d3-d9ef52ea"></div>
										<div style="display: none" id="observablehq-style-d9ef52ea"></div>
										<div style="display: none" id="observablehq-data-d9ef52ea"></div>
										<div style="display: none" id="observablehq-quarters-d9ef52ea"></div>
										<div style="display: none" id="observablehq-ports-d9ef52ea"></div>
										<div style="display: none" id="observablehq-portRank-d9ef52ea"></div>
										<div style="display: none" id="observablehq-qRank-d9ef52ea"></div>
										<div style="display: none" id="observablehq-qPath-d9ef52ea"></div>
										
																			
										<script type="module">
										import {Runtime, Inspector} from "https://cdn.jsdelivr.net/npm/@observablehq/runtime@4/dist/runtime.js";
										import define from "https://api.observablehq.com/d/622dda7b234980d1.js?v=3";
										new Runtime().module(define, name => {
										  if (name === "plot") return new Inspector(document.querySelector("#observablehq-plot-d9ef52ea"));
										  if (name === "d3") return new Inspector(document.querySelector("#observablehq-d3-d9ef52ea"));
										  if (name === "style") return new Inspector(document.querySelector("#observablehq-style-d9ef52ea"));
										  if (name === "data") return new Inspector(document.querySelector("#observablehq-data-d9ef52ea"));
										  if (name === "quarters") return new Inspector(document.querySelector("#observablehq-quarters-d9ef52ea"));
										  if (name === "ports") return new Inspector(document.querySelector("#observablehq-ports-d9ef52ea"));
										  if (name === "portRank") return new Inspector(document.querySelector("#observablehq-portRank-d9ef52ea"));
										  if (name === "qRank") return new Inspector(document.querySelector("#observablehq-qRank-d9ef52ea"));
										  if (name === "qPath") return new Inspector(document.querySelector("#observablehq-qPath-d9ef52ea"));
										  if (name === "viewof category") return new Inspector(document.querySelector("#observablehq-viewof-category-d9ef52ea"));
										});
										</script>

										<br> 
										<!--
										<h2>Why visualize this?</h2>
										<p>
										These waves allow us to see not only how the container traffic compares between different ports over time, but also
										how the traffic varies within each port each quarter. We see that the relative positions of the ports are generally stable:
										Manzanillo International and Port of Balboa see the most container traffic, Colon Container, PSA, and Port of Cristobal continually 
										share 3rd, 4th, and 5th places, and Bocas Fruit places last every time.
										</p>
										<p>
											However, when we start looking at the scale of the traffic (hover over the graph to see TEUs)...
										</p>
									-->
										<h2>My Process</h2>
										<p>
											The vision was simple: an enhanced bump chart that used wave amplitude to convey the ranking within each of the 
											categories. I first did a pen-and-paper sketch. The positions and shape of the waves were arbitrary, but it gave me a 
											reference for what I could now attempt to duplicate using D3.
										</p>

										<figure>
											<img style="display: block; margin-left:auto; margin-right: auto; max-width: 60%;" src="/projects/container-traffic/container-traffic-sketch.png" alt="Container Traffic Sketch" style="width:100%">
											<figcaption  style="text-align:center">Figure 1: Pen-and-paper sketch of my "enhanced bump chart".</figcaption>
										</figure>
										<br>

										<p>
											After I had a basic idea of what the final chart would look like, there were three main phases that went into constructing this visualization:
										</p>

										<p>
											The first one was <b>building the wavy bump chart in a grid</b>, where there would be one row per port and each column would represent a time period
											(quarters in this case). Because I wanted to emphasize ranking, like in a bump chart, instead for actual values of the vertical axis,
											I decided to plot each point twice: once at the beginning and once at the end of each time period. This meant that instead of points,
											I was connecting horizontal line segments. To have the wave amplitude encode the ranking of each quarter in 
											comparison to other quarters for each port, I simply used the repeating values of a sine wave (0, 1, 0, -1).
										</p>

										<figure>
											<img style="display: block; margin-left:auto; margin-right: auto; max-width: 60%;" src="/projects/container-traffic/container-traffic-points.png" alt="Container Traffic Sketch" style="width:100%">
											<figcaption  style="text-align:center">Figure 2: Creating repeating sine wave.</figcaption>
										</figure>
										<br>

										<p>
											I defined a fixed amplitude of a few pixels and started with a straight line that was really four horizontal line segments connected 
											to each other. For example, the following positions: (0,0), (10,0), (20,0), (30,0), etc. I used 9 points for each - 8 becase I wanted 
											the sine wave to repeat twice so it could be appreiated better, and an extra point because each segment needs a start and an end. Then
											I scaled the sine sequence by this amplidute, for example (0, 10, 0, -10), and I added this repeating scaled pattern to my line segment 
											y-coordinates so that the vertical value would shift up and down like a wave. This was relatively easy with the d3.line().curve() function to 
											generate an SVG path for each port.
										</p>
										
										<figure>
											<img style="display: block; margin-left:auto; margin-right: auto; max-width: 60%;" src="/projects/container-traffic/container-traffic-grid.png" alt="Container Traffic Sketch" style="width:100%">
											<figcaption  style="text-align:center">Figure 3: Fixed amplitude waves in D3".</figcaption>
										</figure>
										<br>

										<p>
											The second part of the process was <b>making the wave amplitudes vary</b> each time period. This meant that instead of using a
											constant value, the scaling value for the y-coordinate of each point would be calculated depending on where that specific quarter ranked for 
											the port. Now the visualization was about to get messier, but at this point playing with the stroke widths and color could make it
											more aesthetically pleasing. At least the lines were not squiggly for no reason, there was some qualitative information contained in this design choice.
										</p>
										
										<figure>
											<img style="display: block; margin-left:auto; margin-right: auto; max-width: 60%;" src="/projects/container-traffic/container-traffic-styling.png" alt="Container Traffic Sketch" style="width:100%">
											<figcaption  style="text-align:center">Figure 4: Experimenting with styling.</figcaption>
										</figure>
										<br>

										<p>
											The last step was mostly cosmetic and consisted in adding annotations, such as a title, a legend, and styling the axes (adding port names and 
											formatting ticks). Finally, a drop-down list for user input to change the subset of the data from processing of empty, full, or all containers.
											While there are definitely more robust methods to do this, <a href="https://observablehq.com/@observablehq/introduction-to-views">Observable 
											views</a> came in handy for adding this interactive detail to an otherwise static application!
										</p>

									</section>
								
									<!-- Footer -->
										<footer id="footer">
											<p class="copyright">Heilly GÃ¡lvez &copy; 2023.</p>
										</footer>
							</div>
						</div>
					
					</div>
					
				</div>
	
			<!-- Scripts -->
				<script src="assets/js/jquery.min.js"></script>
				<script src="assets/js/browser.min.js"></script>
				<script src="assets/js/breakpoints.min.js"></script>
				<script src="assets/js/util.js"></script>
				<script src="assets/js/main.js"></script>
	
		</body>
</html>
